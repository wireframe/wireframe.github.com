---
layout: post
title: "Wicket AjaxEditInPlaceLabel"
date: 2006-10-03
comments: false
categories:
 - javascript
 - java
 - scriptaculous
 - wicket
 - ajax
---

<div class='post'>
<p>I think it's time to put back on my Wicket hat, and start kicking ass again.  It's been a while since I've worked with Wicket, and I've picked it back up for a new project I'm working on.  It's an AJAX heavy application, and that's where Wicket (and scriptaculous) really shine.</p><br /><br /><p>My first AJAX Wicket component that I need is an <b>Edit In Place Label</b>.  You'll find examples of this component all over the web.  <a href="http://www.flickr.com">Flickr</a> uses this type of component heavily, and you can browse through the <a href="http://script.aculo.us/">scriptaculous</a> examples for others.</p><br /><br /><p>I want the client code to be nearly identical to creating a normal textfield.  No special interfaces or extra hoops to jump through.  The value from the AJAX call should be saved on the object, just the same as for a textfield.</p><br /><br /><pre><br />public EditPresentationPanel(String wicketId, MyObject myObject) {<br />  super(wicketId);<br /><br />  add(new AjaxEditInPlaceLabel("name", new PropertyModel(myObject, "name")));<br />}<br /></pre><br /><br /><p>So, without further delay, here's the code!  I'll be checking this into the wicket-stuff project as soon as I cleanup a bit of the other code in that project.  It's still using scriptaculous version 1.5!</p><br /><br /><pre><br />public class AjaxEditInPlaceLabel extends AbstractTextComponent {<br />  private AbstractAjaxBehavior handler;<br /><br />  public AjaxEditInPlaceLabel(String wicketId, IModel model) {<br />    super(wicketId);<br />    setModel(model);<br /><br />    this.handler = new AbstractAjaxBehavior() {<br />      protected String getImplementationId() {<br />        return "scriptaculous";<br />      }<br />      protected void onRenderHeadInitContribution(Response response) {<br />        writeJsReference(response, new PackageResourceReference(AjaxEditInPlaceLabel.class, "prototype.js"));<br />        writeJsReference(response, new PackageResourceReference(AjaxEditInPlaceLabel.class, "scriptaculous.js"));<br />      }<br /><br />      public void onRequest() {<br />        FormComponent formComponent = (FormComponent) getComponent();<br />        formComponent.validate();<br />        if (formComponent.isValid()) {<br />          formComponent.updateModel();<br />        }<br />        String value = formComponent.getValue();<br />        RequestCycle.get().setRequestTarget(new StringRequestTarget(value));<br />      }<br />    };<br />    add(handler);<br /><br />    setOutputMarkupId(true);<br />  }<br /><br />  public String getInputName() {<br />    return "value";<br />  }<br /><br />  protected final void onComponentTagBody(final MarkupStream markupStream, final ComponentTag openTag) {<br />    replaceComponentTagBody(markupStream, openTag, getValue());<br />  }<br /><br />  protected void onRender(MarkupStream markupStream) {<br />    super.onRender(markupStream);<br /><br />    JavascriptBuilder builder = new JavascriptBuilder();<br />    builder.addLine("new Ajax.InPlaceEditor('" + getMarkupId() + "', ");<br />    builder.addLine("  '" + handler.getCallbackUrl() + "', ");<br />    builder.addLine("  {});");<br />    getResponse().write(builder.toString());<br />  }<br />}<br /></pre><br /><br /><p>There are a couple things I really like about this implementation.  This component gets form validation "for free", which makes it very easy to reuse other Wicket validators for this component.</p><br /><br /><p>Creating this component took me longer than I was hoping, but that's largly because I'm a bit rusty with Wicket.  It was a bit difficult to follow other Wicket AJAX examples out there because my app is built  for Wicket-1.2 and most of the example code has been written for Wicket-2.0.</p><br /><br /><!-- technorati tags begin --><br /><p style="font-size:10px;text-align:right;">technorati tags:<br /><a href="http://technorati.com/tag/java" rel="tag">java</a>, <br /><a href="http://technorati.com/tag/javascript" rel="tag">javascript</a>,<br /><a href="http://technorati.com/tag/ajax" rel="tag">ajax</a>,<br /><a href="http://technorati.com/tag/wicket" rel="tag">wicket</a>,<br /><a href="http://technorati.com/tag/scriptaculous" rel="tag">scriptaculous</a>,<br /><a href="http://technorati.com/tag/prototype" rel="tag">prototype</a><br /></p><br /><!-- technorati tags end --></div>
