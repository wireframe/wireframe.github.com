---
layout: post
title: "How Prototype Can Break Your Site"
date: 2006-07-28
comments: false
categories:
 - javascript
---

<div class='post'>
<p>I have really grown to like <a href="http://prototype.conio.net/">prototype</a> and all of the extensions it brings to Javascript.  The more I use it, the harder it is for me to use <i>standard</i> Javascript for certain operations (ajax, looping, etc).</p><br /><br /><p>Unfortunately, my day job project does not use prototype, and there's been quite a bit of resistance to adopting it.  The main argument against using prototype in our application is that it will break a small number of legacy Javascript.</p><br /><br /><p><i>What</i>?  Prototype can <strong>break</strong> existing scripts?  That's right, and although it's only one use case in a small number of scripts, now everyone has become gun shy around adopting prototype.  I'll try to describe the problem.  First, here is a simple example that will demonstrate the issue.</p><br /><br /><pre><br />var a = new Array();<br />a[0] = 1;<br />a[1] = 2;<br />for (var i in a) &#123;<br />  print(i + " = "+ a[i]);<br />&#125;<br /></pre><br /><br /><p>Now, before prototype is added to the page, this Javascript will have the following output:</p><br /><br /><pre><br />0 = 1<br />1 = 2<br /></pre><br /><br /><p>After prototype is added to the page, the for loop acts differently and also iterates over the methods that Prototype has added to the <code>Array</code> object.  Now, the output looks like this:<br/><br /></p><br /><br /><pre><br />0 = 1 <br />1 = 2 <br />each = function() &#123; &#125;<br />iterate = function() &#123; &#125;<br /></pre><br /><br /><p>There are two sides of the camp when it comes to this problem, and both sides are <strong>very</strong> passionate that they are right and the other is wrong.  One side blames prototype for modifying core Javascript objects.  I have a feeling that this group would not appreciate Ruby's ability to dynamically add methods to any object.  The other side blames Javascript developers for using a dangerous version of the for loop.  From what I've read, using <a href="http://www.andrewdupont.net/2006/05/18/javascript-associative-arrays-considered-harmful/">this style of for loop for iterating over associative arrays <i>works</i>, but it's not <i>correct</i></a>.</p><br /><br /><pre><br />//this style of for loop is really intended for iterating over a hash<br />//or for working with an object as a hash of properties<br />for (var property in object) &#123;    <br />  print(property + " = "+ object[property]);<br />&#125;<br /><br />//this is the correct way to iterate over an array.<br />for (var x = 0; i &lt; array.length; i++) &#123;<br />  print(x + " = " +  array[x]);<br />&#125;<br /></pre><br /><br /><p>So, there are definitely options for getting around these issues.  One is to update existing Javascript to use <i>correct</i> array iteration. Heck, since you're integrating prototype, might as use their <a href="http://jroller.com/page/wireframe/?anchor=humane_object_iteration">kick ass object iteration syntax</a>!  If updating your current scripts isn't an option, there are <a href="http://ajaxian.com/archives/prototypify-running-prototype-code-with-legacy-code">wrapper scripts that will allow developers to control which Javascript functions get the special prototype syntax</a>.  This would allow you to add prototype without breaking existing scripts.<br /></p><br /><br /><p>Realistically, this is only an issue if you're trying to bring prototype into a legacy project.  If you're starting a new project, do <strong>not</strong> hesitate to use prototype.  It's simply a no brainer.</p><br /><br /><!-- technorati tags begin --><br /><p style="font-size: 10px; text-align: right;"><br />technorati tags: <br /><a rel="tag" href="http://technorati.com/tag/javascript">javascript</a>, <br /><a rel="tag" href="http://technorati.com/tag/prototype">prototype</a><br /></p><br /><!-- technorati tags end --></div>
