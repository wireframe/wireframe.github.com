---
layout: post
title: "More Intuitive Search"
date: 2005-12-08
comments: false
categories:
 - java
 - shard
 - search
---

<div class='post'>
<p>One of the coolest features in <a href="http://shard.codecrate.com">shard-phoenix</a> is the quick search.&nbsp; My first version of the quick search was a "<span style="font-weight: bold;">Search when you type</span>" implementation where every keypress fired off a search and updated the GUI.&nbsp; Although impressive, it was not exactly usable.&nbsp; Performing a search for <span style="font-style: italic;">every</span> single keypress is simply too expensive, especially on slower PC's.</p><br /><p>What I <span style="font-style: italic;">really</span> wanted was a "<span style="font-weight: bold;">Search when you pause</span>" implementation.&nbsp; I wanted the user to type in their query phrase, and fire off the search when they have a delay (300 milliseconds seems to be the magic number).&nbsp; I was fairly surprised at the lack of examples or tutorials to help me accomplish this and that's why I'm posting my "slimmed down" implementation here.&nbsp; The complete source code can be found as part of the <a href="https://shard.dev.java.net/source/browse/shard/shard-phoenix/src/main/java/com/codecrate/shard/ui/component/">shard-phoenix project</a>.</p><br /><br /><pre class="code"><br />public class SearchComponent extends JPanel {<br />    private static final int SEARCH_DELAY_MILLIS = 300;<br />    private JTextField queryText = null;<br />    private Timer timer = new Timer();<br /><br />    public SearchComponent() {<br />        super();<br />        add(getQueryText(), null);<br />    }<br /><br />    private JTextField getQueryText() {<br />        if (queryText == null) {<br />            queryText = new JTextField();<br />            queryText.setColumns(10);<br />            queryText.getDocument().addDocumentListener(new SearchDocumentListener());<br />        }<br />        return queryText;<br />    }<br /><br />    private class SearchDocumentListener implements DocumentListener {<br />        public void changedUpdate(DocumentEvent event) {<br />            processEvent(event);<br />        }<br />        public void insertUpdate(DocumentEvent event) {<br />            processEvent(event);<br />        }<br />        public void removeUpdate(DocumentEvent event) {<br />            processEvent(event);<br />        }<br />        private void processEvent(DocumentEvent event) {<br />            Document document = event.getDocument();<br />            try {<br />                String value = document.getText(0, document.getLength()).trim();<br />                if (0 < value.length()) {<br />                    TimerTask delaySearchTask = new DelaySearchTask(value);<br />                    timer.schedule(delaySearchTask, SEARCH_DELAY_MILLIS);<br />                } else {<br />                    //clear search filter<br />                }<br />            } catch (BadLocationException e) {<br />                //print error<br />            }<br />        }<br />    }<br /><br />    private class DelaySearchTask extends TimerTask {<br />        private final String originalInput;<br /><br />        public DelaySearchTask(String originalInput) {<br />            this.originalInput = originalInput;<br />        }<br />        public void run() {<br />            if (!hasInputChanged()) {<br />                //perform search now!<br />            }<br />        }<br />        private boolean hasInputChanged() {<br />            return !originalInput.equals(getQueryText().getText());<br />        }<br />    }<br />}<br /></pre><br /><br /><!-- technorati tags begin --><p style="font-size:10px;text-align:right;">technorati tags: <a href="http://technorati.com/tag/java" rel="tag">java</a>, <a href="http://technorati.com/tag/swing" rel="tag">swing</a>, <a href="http://technorati.com/tag/shard" rel="tag">shard</a>, <a href="http://technorati.com/tag/search" rel="tag">search</a></p><!-- technorati tags end --></div>
