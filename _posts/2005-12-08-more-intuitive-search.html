---
layout: post
title: "More Intuitive Search"
date: 2005-12-08
comments: false
categories:
 - java
 - shard
 - search
---

<div class='post'>
<p>One of the coolest features in <a href="http://shard.codecrate.com">shard-phoenix</a> is the quick search.&nbsp; My first version of the quick search was a "<span style="font-weight: bold;">Search when you type</span>" implementation where every keypress fired off a search and updated the GUI.&nbsp; Although impressive, it was not exactly usable.&nbsp; Performing a search for <span style="font-style: italic;">every</span> single keypress is simply too expensive, especially on slower PC's.</p><br /><p>What I <span style="font-style: italic;">really</span> wanted was a "<span style="font-weight: bold;">Search when you pause</span>" implementation.&nbsp; I wanted the user to type in their query phrase, and fire off the search when they have a delay (300 milliseconds seems to be the magic number).&nbsp; I was fairly surprised at the lack of examples or tutorials to help me accomplish this and that's why I'm posting my "slimmed down" implementation here.&nbsp; The complete source code can be found as part of the <a href="https://shard.dev.java.net/source/browse/shard/shard-phoenix/src/main/java/com/codecrate/shard/ui/component/">shard-phoenix project</a>.</p><br /><br /><pre class="code"><br />public class SearchComponent extends JPanel &#123;<br />    private static final int SEARCH_DELAY_MILLIS = 300;<br />    private JTextField queryText = null;<br />    private Timer timer = new Timer();<br /><br />    public SearchComponent() &#123;<br />        super();<br />        add(getQueryText(), null);<br />    &#125;<br /><br />    private JTextField getQueryText() &#123;<br />        if (queryText == null) &#123;<br />            queryText = new JTextField();<br />            queryText.setColumns(10);<br />            queryText.getDocument().addDocumentListener(new SearchDocumentListener());<br />        &#125;<br />        return queryText;<br />    &#125;<br /><br />    private class SearchDocumentListener implements DocumentListener &#123;<br />        public void changedUpdate(DocumentEvent event) &#123;<br />            processEvent(event);<br />        &#125;<br />        public void insertUpdate(DocumentEvent event) &#123;<br />            processEvent(event);<br />        &#125;<br />        public void removeUpdate(DocumentEvent event) &#123;<br />            processEvent(event);<br />        &#125;<br />        private void processEvent(DocumentEvent event) &#123;<br />            Document document = event.getDocument();<br />            try &#123;<br />                String value = document.getText(0, document.getLength()).trim();<br />                if (0 < value.length()) &#123;<br />                    TimerTask delaySearchTask = new DelaySearchTask(value);<br />                    timer.schedule(delaySearchTask, SEARCH_DELAY_MILLIS);<br />                &#125; else &#123;<br />                    //clear search filter<br />                &#125;<br />            &#125; catch (BadLocationException e) &#123;<br />                //print error<br />            &#125;<br />        &#125;<br />    &#125;<br /><br />    private class DelaySearchTask extends TimerTask &#123;<br />        private final String originalInput;<br /><br />        public DelaySearchTask(String originalInput) &#123;<br />            this.originalInput = originalInput;<br />        &#125;<br />        public void run() &#123;<br />            if (!hasInputChanged()) &#123;<br />                //perform search now!<br />            &#125;<br />        &#125;<br />        private boolean hasInputChanged() &#123;<br />            return !originalInput.equals(getQueryText().getText());<br />        &#125;<br />    &#125;<br />&#125;<br /></pre><br /><br /><!-- technorati tags begin --><p style="font-size:10px;text-align:right;">technorati tags: <a href="http://technorati.com/tag/java" rel="tag">java</a>, <a href="http://technorati.com/tag/swing" rel="tag">swing</a>, <a href="http://technorati.com/tag/shard" rel="tag">shard</a>, <a href="http://technorati.com/tag/search" rel="tag">search</a></p><!-- technorati tags end --></div>
