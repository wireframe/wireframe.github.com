---
layout: post
title: "JSLint Rails Javascript Responses"
date: 2011-06-27
comments: false
categories:
 - javascript
 - rails
 - testing
---

<div class='post'>
Unit testing Javascript has quickly become an absolute requirement for building a modern web application. &nbsp;It's not uncommon for most web applications to have more Javascript code/libraries than serverside logic. &nbsp;There are plenty of frameworks javascript testing frameworks available for unit testing your standalone javascript components&nbsp;(<a href="http://www.jsunit.net/">JSUnit</a>, <a href="http://docs.jquery.com/Qunit">QUnit</a>, etc), but how do you test Javascript responses generated by Rails?<br /><br />Let's start by describing problem in a bit more detail. &nbsp;Here are a few snippits of code that you'll find in pretty much any AJAX heavy Rails application.<br /><br />Example Rails form for creating a new blog post via AJAX:<br /><pre class="code"># app/views/blogs/new.html.haml<br />= form_for Blog.new, :remote =&gt; true do |f|<br />&nbsp;&nbsp;= f.text_area :body<br />&nbsp;&nbsp;= f.submit</pre><br />Example Rails controller to create blog post:<br /><pre class="code"># app/controllers/blog_controller.rb<br />class BlogController &lt; ApplicationController<br />&nbsp;&nbsp;def create<br />&nbsp;&nbsp; &nbsp;@blog = Blog.create params[:blog]<br />&nbsp;&nbsp; &nbsp;respond_with @blog<br />&nbsp;&nbsp;end<br />end</pre><br />Example Rails Javascript ERB response to return new blog post:<br /><pre class="code"># app/views/blogs/create.js.erb<br />$('#new_blog_form').trigger('reset');<br />$('body').append('&lt;h2&gt;New Blog Post has been created!&lt;/h2&gt;');<br />$('body').append('&lt;%= escape_javascript(@blog.body) %&gt;');</pre><br />Now this is a very simple example, but how can you effectively assert that the Javascript response is doing what you expect? &nbsp;Sure, you can use selenium or some other heavyweight testing library to boot up a browser and exercise your Javascript, but there's got to be a quicker way to get the job done.<br /><br />With a few simple solutions, you can get a lot of bang for your buck without introducing more complex and finicky end to end testing frameworks.<br /><br /><h2>Move Javascript Logic to Static Component</h2>Refactoring your Javascript response to use the "Fat Component, Skinny Response" pattern is the <a href="http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model">same pattern we've been using for building our controllers</a>, and it moves all of the logic out of your ERB templates and into a standalone (and testable) Javascript component.<br /><br />Example refactored Javascript response:<br /><pre class="code"># app/views/blogs/create.js.erb<br />myApp.createBlog(&lt;%= @blog.to_json %&gt;);</pre><br />Example Javascript component:<br /><pre class="code"># public/javascripts/application.js<br />myApp = &#123;<br />&nbsp;&nbsp;createBlog: function(data) &#123;<br />&nbsp;&nbsp; &nbsp;$('#new_blog_form').trigger('reset');<br />&nbsp;&nbsp; &nbsp;$('body').append('&lt;h2&gt;New Blog Post has been created!&lt;/h2&gt;');<br />&nbsp;&nbsp; &nbsp;var content = $('p').text(data.body);<br />&nbsp;&nbsp; &nbsp;$('body').append(content);<br />&nbsp;&nbsp;&#125;<br />&#125;;</pre><br />Now you can effectively unit test your component using traditional Javascript testing libraries.<br /><br /><h2>JSLint the Rails Response</h2><br /><a href="http://www.jslint.com/">JSLint</a> is a simple and very effective smoketest to ensure that any Javascript response is valid and without syntax errors.  This prevents any extra semi-colons or simple syntax errors from breaking your user's browser.  All "modern" browsers are pretty forgiving when dealing with Javascript errors, but one browser in particular *cough* IE *cough* can really freak out if it encounters invalid Javascript<br /><br />Rspec users can drop this <a href="https://gist.github.com/1042920">be_lintable helper</a> into there application for a quick sanity check that their JS responses should be operational.  Not using RSpec?  The <a href="https://github.com/psionides/jslint_on_rails">JSLint on Rails plugin</a> is pretty simple to integrate into any application.<br /><br /><pre class="code">describe 'xhr post :create' do<br />&nbsp;&nbsp;before &#123; xhr :post, :create, :blog =&gt; &#123;:body =&gt; 'test'&#125; &#125;<br />&nbsp;&nbsp;it &#123; response.body.should be_lintable &#125;<br />end</pre><br />Now go forth and test those Javascript Rails responses!<br /></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Very nice pattern.  I&#39;m giving that a go right now.</div>
</div>
</div>
