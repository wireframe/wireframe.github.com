---
layout: post
title: "Continuous Deployment for Rails"
date: 2009-09-15
comments: false
categories:
 - ruby
 - process
 - lean_startup
 - rails
 - testing
---

<div class='post'>
It's literally been months since I've manually typed "<i>cap production deploy</i>".  For the past several months, we've been implementing a <a href="http://www.startuplessonslearned.com/">lean startup process</a> and using continuous deployment to push code to production. Continuous deployment's core premise is to deploy code to production with every commit.  From my standpoint, it's been a dream come true.<br /><br /><img src="http://farm3.static.flickr.com/2094/2087879492_4771871d28.jpg" /><br /><i>Just Ship It!</i><br /><br />The theory behind continuous deployment is rather simple, "<b>unreleased code is a liability</b>".  Features that takes weeks to build without getting <b>real</b> feedback are distracting you from focusing on what your customers are seeing every day.  Using continuous deployment <b>forces</b>&nbsp;you to think differently about feature development.  Large complex features become incremental deployments with user feedback at each step to ensure you're headed in the right direction (and to pull the plug as quickly as possible if you're not).  If you're able to adjust your feature during the development cycle, you save time (and money) that would be wasted on going in a wrong direction.<br /><br />Effective and thorough testing are all that stands between a bad commit and a busted production environment, which means that continuous integration is absolutely critical. The Testing Nazi in me taken full advantage of this to push the envelope on the importance of testing. &nbsp;I've even hired a set of angry midgets to enforce proper testing standards...<br /><br /><img src="http://farm3.static.flickr.com/2362/2190903226_1be8b3766b.jpg" /><br /><i>If it's not tested, it's CRAP!</i><br /><br /><a href="http://cruisecontrolrb.thoughtworks.com/">Cruisecontrol.rb</a> is the heart and soul of our continuous deployment, but it's actually a very simple process.  We register a custom rake task which runs our complete testsuite and if all tests pass,  cruisecontrol flips the switch and deploys the code.  Our rake task looks something like this:<br /><pre>#lib/tasks/cruisecontrol.rake<br />desc 'Run all continuous integration tests'<br />task :cruise do<br />  #run all tests<br />  #see rails/lib/taks/testing.rake<br />  errors = %w(units functionals integration javascripts acceptance).collect do |task|<br />    begin<br />      Rake::Task["test:#&#123;task&#125;"].invoke<br />      nil<br />    rescue =&gt; e<br />      task<br />    end<br />  end.compact<br />  abort "Errors running #&#123;errors.to_sentence(:locale =&gt; :en)&#125;!" if errors.any?<br /><br />  system "cap production deploy"<br />end<br /></pre><br />Our testsuite started off as a standard rails deployment and has grown over time to accommodate our evolving testing practices.  Building a modern Web 2.0 application means you'll be spending a <b>lot</b> of time dealing with web browsers, so we've spent extensive time integrating tools for testing web browsers and javascript.  Our current testsuite includes:<br /><ul><li>unit tests (Test::Unit)</li><li>functional tests (ActionController::TestCase)</li><li>integration tests (ActionController::IntegrationTest)</li><li>javascript tests (<a href="http://github.com/relevance/blue-ridge/tree/master">BlueRidge</a>/<a href="http://github.com/nkallen/screw-unit">ScrewUnit</a>)</li><li>acceptance tests (<a href="http://seleniumhq.org/">Selenium</a>)</li></ul>It's important to remember that you shouldn't go overboard building out infrastructure to support a continuous deployment process.  The same rule of "undeployed code is a liability" applies to your testing environment.  You absolutely can <b>not</b> afford to waste time building out a suite of tools until you need it.  Simply take incremental steps from where you are today and slowly add in infrastructure as needed.  Each step will incrementally move you towards a better system overall.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Alex Sharp</div>
<div class='content'>
Thanks for posting about this, very interesting. How has adopting a continuous deployment workflow changed how you approach stories and features?</div>
</div>
</div>
