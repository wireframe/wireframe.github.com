---
layout: post
title: "JDirectoryChooser Binding for Spring Richclient"
date: 2006-06-28
comments: false
categories:
 - java
 - swing
 - spring
 - springrcp
---

<div class='post'>
<p>I've been continuing work on <a href="http://shard.codecrate.com">shard</a>, and one aspect that's been bothering me is how we handle importing of datasets.  I <strong>really</strong> dislike the current implementation using a Swing <code>JFileChooser</code>.  It doesn't give the user enough context to know that they've selected a valid dataset.  So, I decided to check out the <code>JDirectoryChooser</code> from the <a href="http://common.l2fprod.com">common l2fprod project</a>.</p><br /><br /><p>I have really enjoyed this component for the past couple days, so I decided to do some work to integrate it into <a href="http://spring-rich-c.sf.net">spring richclient</a>.  My main goal was to add a custom binding so that data entry forms can automatically use this component if their model object has a <code>java.util.File</code> property.  Here's an example of how to use the new binding control:</p><br /><br /><pre><br />    public class DirectorySelectionForm extends AbstractForm {<br />        private static final String PAGE_NAME = "importPage";<br /><br />        public DirectorySelectionForm(FormModel formModel) {<br />            super(formModel, PAGE_NAME);<br />        }<br /><br />        protected JComponent createFormControl() {<br />            SwingBindingFactory bindingFactory = (SwingBindingFactory) getBindingFactory();<br /><br />            JDirectoryChooser directoryChooser = new JDirectoryChooser();<br />            directoryChooser.setControlButtonsAreShown(false);<br /><br />            TableFormBuilder formBuilder = new TableFormBuilder(bindingFactory);<br />            formBuilder.add(new JDirectoryChooserBinding(getFormModel(), "selectedDirectory", directoryChooser));<br /><br />            return formBuilder.getForm();<br />        }<br />    }<br /></pre><br /><br /><p>The code to build this custom binding was pretty straightforward and might be another cantidate for inclusion into the <a href="http://common.l2fprod.com/articles/taskpane-springrcp.php">common l2fprod spring-rcp components</a>.</p><br /><br /><pre><br />public class JDirectoryChooserBinding extends CustomBinding {<br /><br />    private final JDirectoryChooser component;<br /><br />    public JDirectoryChooserBinding(FormModel model, String property, JDirectoryChooser component) {<br />        super(model, property, File.class);<br />        this.component = component;<br />    }<br /><br />    protected JComponent doBindControl() {<br />        component.setSelectedFile((File)getValue());<br />        component.addPropertyChangeListener(new PropertyChangeListener() {<br />            public void propertyChange(PropertyChangeEvent evt) {<br />                String prop = evt.getPropertyName();<br />                if(JDirectoryChooser.SELECTED_FILE_CHANGED_PROPERTY.equals(prop)) {<br />                    File file = (File) evt.getNewValue();<br />                    controlValueChanged(file);<br />                }<br />            }<br />        });<br />        return component;<br />    }<br /><br />    protected void readOnlyChanged() {<br />        component.setEnabled(isEnabled() && !isReadOnly());<br />    }<br /><br />    protected void enabledChanged() {<br />        component.setEnabled(isEnabled() && !isReadOnly());<br />    }<br /><br />    protected void valueModelChanged(Object newValue) {<br />        component.setSelectedFile((File)newValue);<br />    }<br />}<br /></pre><br /><br /><p>I also built a simple binder that would allow you to register all <code>java.util.File</code> properties to use this <code>JDirectoryChooserBinding</code>.</p><br /><pre><br />public class JDirectoryChooserBinder extends AbstractBinder {<br /><br />    protected JDirectoryChooserBinder() {<br />        super(File.class);<br />    }<br /><br />    protected JComponent createControl(Map context) {<br />        return new JDirectoryChooser();<br />    }<br /><br />    protected Binding doBind(JComponent control, FormModel formModel, String formPropertyPath, Map context) {<br />        final JDirectoryChooser directoryChooser = (JDirectoryChooser) control;<br />        return new JDirectoryChooserBinding(formModel, formPropertyPath, directoryChooser);<br />    }<br />}<br /></pre><br /><br /><p>Simple, but there seem to be a few issues to be worked out yet.  I tried adding a custom validator to my model object to make sure that the selected directory contained relevant files, but the validator did not work correctly.  It always showed the selected directory as null.  I'm assuming this is an issue with my validator, but I haven't been able to figure this out yet.</p><br /><br /><p>That's all for now.</p><br /><br /><br /><!-- technorati tags begin --><br /><p style="font-size: 10px; text-align: right;">technorati tags: <br /><a href="http://technorati.com/tag/java" rel="tag">java</a>, <br /><a href="http://technorati.com/tag/swing" rel="tag">swing</a>, <br /><a href="http://technorati.com/tag/l2fprod" rel="tag">l2fprod</a>, <br /><a href="http://technorati.com/tag/spring" rel="tag">spring</a>, <br /><a href="http://technorati.com/tag/shard" rel="tag">shard</a><br /></p><br /><!-- technorati tags end --></div>
