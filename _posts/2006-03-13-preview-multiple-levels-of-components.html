---
layout: post
title: "Preview Multiple Levels of Components"
date: 2006-03-13
comments: false
categories:
 - javascript
 - java
 - wicket
---

<div class='post'>
<p>My <a href="http://jroller.com/page/wireframe?entry=wicket_preview_with_one_javascript">previous</a> <a href="http://jroller.com/page/wireframe?entry=auto_previewable_wicket_pages">incarnations</a> of the <code>wicket:preview</code> feature have fallen short when trying to preview multiple levels of components.  I personally don't think it's that big of a deal for the preview to not handle this, but based on the feedback I've received, I decided to at least look into it.</p><br /><br /><p>Here's a sample scenario that I've been using to test this idea out.</p><br /><pre><br /> mysite<br />  |__Home.html             -- This is the homepage that includes the login panel<br />  |__login<br />  | \__Login.html          -- The login panel includes the cool widget<br />  |__widget<br />  | \__CoolWidget.html<br /></pre><br /><br /><h3>mysite/Home.html</h3><br /><pre><br />&lt;html&gt;<br />&lt;head&gt;<br />  &lt;title&gt;Preview Multiple Levels of Components&lt;/title&gt;<br /><br />&lt;wicket:remove&gt;<br />  &lt;script type=&quot;text/javascript&quot; src=&quot;wicket-preview.js&quot;&gt;&lt;/script&gt;<br />&lt;/wicket:remove&gt;<br /><br />&lt;/head&gt;<br />&lt;body&gt;<br />Welcome to my cool site!<br />  &lt;div wicket:id=&quot;loginForm&quot; wicket:preview=&quot;login/Login.html&quot;&gt;Text should be replaced&lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></pre><br /><br /><h3>mysite/login/Login.html</h3><br /><pre><br />username: &lt;input wicket:id=&quot;username&quot; type=&quot;text&quot; name=&quot;username&quot; /&gt;<br />password: &lt;input wicket:id=&quot;password&quot; type=&quot;password&quot; name=&quot;password&quot; /&gt;<br /><br />&lt!-- Notice the path used to the next component is relative to this component.  NOT the home page!  --&gt;<br />&lt;div wicket:id=&quot;widget&quot; wicket:preview=&quot;../widget/CoolWidget.html&quot;&gt;<br />widget goes here...<br />&lt;/div&gt;<br /></pre><br /><br /><h3>mysite/widget/CoolWidget.html</h3><br /><pre><br />WOW!<br /></pre><br /><br /><p>Using this  setup, how exactly can multiple levels of components be previewed?  The path from the Home template to the Login template is straight forward, but the path from the Login template to the CoolWidget is relative to the Login template, not the Home page!  </p><br /><br /><p>I've reworked the <code>wicket-preview-behaviour.js</code> to support this setup by recursively including the components. Each time an element is included as a preview, It's path to the included component is saved and tacked onto any included components that need to be previewed.  I'm no javascript expert, but the code didn't turn out too bad!</p><br /><br /><h3>wicket-preview-behaviour.js</h3><br /><pre><br />dojo.require(&quot;dojo.io.*&quot;);<br /><br />function insertPreview(element, url) {<br />  dojo.io.bind({<br />    url: url,<br />    load: function(type, data, evt) { <br />      if (url.indexOf('/') != -1) {<br />        var path = url.substring(0, url.lastIndexOf('/') + 1);<br />        //add path to current component to next preview object<br />        data = data.replace('wicket:preview=\&quot;/g, &quot;wicket:preview=\&quot;&quot; + path);<br />      }<br />      element.innerHTML = data;<br /><br />      //remove attribute to prevent infinite recursion<br />      element.removeAttribute('wicket:preview');<br /><br />      //apply rules to newly included components<br />      Behaviour.apply();<br />    },<br />    mimetype: &quot;text/plain&quot;<br />  });<br />}<br /><br />var myrules = {<br />  'div': function(element) {<br />    var url = element.getAttribute('wicket:preview');<br />    if (url) {<br />      insertPreview(element, url);<br />    }<br />  }<br />};<br /><br />Behaviour.register(myrules);<br /></pre><br /><br /><p>My favorite part of this feature is that developers don't need to change any of their HTML templates in order for this to work.  All you need to do is drop in the updated javascript file, and it "just works".  I think that would be valuable for the <code>div</code> preview to have some special CSS style, but that can be handled later.  Maybe someone with better UI abilities can give feedback on what would be appropriate.</p><br /><br /><p>Are there any other outstanding issues that Wicket developers/users can think of?</p><br /><br /><!-- technorati tags begin --><br /><p style="font-size: 10px; text-align: right;">technorati tags: <br /><a href="http://technorati.com/tag/java" rel="tag">java</a>, <br /><a href="http://technorati.com/tag/wicket" rel="tag">wicket</a>,<br /><a href="http://technorati.com/tag/javascript" rel="tag">javascript</a>, <br /><a href="http://technorati.com/tag/ajax" rel="tag">ajax</a>, <br /><a href="http://technorati.com/tag/dojo" rel="tag">dojo</a>,<br /><a href="http://technorati.com/tag/behaviour" rel="tag">behaviour</a><br /></p><br /><!-- technorati tags end --></div>
