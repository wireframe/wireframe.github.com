---
layout: post
title: "Wicket Preview With One Javascript"
date: 2006-03-10
comments: false
categories:
 - javascript
 - java
 - wicket
---

<div class='post'>
<p>Third times the charm, right?  There's still a few improvements I would like to make to the <code>wicket:preview</code> feature, but here's how I got it to work with a single javascript include.</p><br /><br /><p>Here's an example of the new page with only one javascript include.</p><br /><pre><br />&lt;html&gt;<br />&lt;head&gt;<br />  &lt;title&gt;Offline Preview With One Javascript&lt;/title&gt;<br /><br />&lt;wicket:remove&gt;<br />  &lt;script type=&quot;text/javascript&quot; src=&quot;wicket-preview.js&quot;&gt;&lt;/script&gt;<br />&lt;/wicket:remove&gt;<br /><br />&lt;/head&gt;<br />&lt;body&gt;<br />  &lt;div wicket:id=&quot;loginForm&quot; wicket:preview=&quot;Login.html&quot;&gt;Text should be replaced&lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br /></html><br /></pre><br /><br /><p>The <code>wicket-preview.js</code> file has changed quite a bit.  It is now essentially just a "bootstrapping" script, to load all the other javascript files.  It is <em>heavily</em> influenced by the <a href="http://script.aculo.us/">scriptaculous</a> bootstrapping code, but I had to change a few things here and there to make it more understandable for me.  I'm not a big fan of the excessive method chaining that they were using, and I'm not too familiar with some of the prototype syntax either.  All of the other work has been pushed to <code>wicket-preview-behaviour.js</code></p><br /><br /><p>One <em>very</em> important thing to remember, is that the bootstrapping javascript cannot reference any of the included functions.  I got stuck on this for a couple hours by trying to bootstrap <em>and</em> reference the Behaviour objects in the same place.  Oh well, I guess you live and learn...</p><br /><br /><pre><br />var WicketPreview = &#123;<br />  require: function(libraryName) &#123;<br />    // inserting via DOM fails in Safari 2.0, so brute force approach<br />    document.write('&lt;script type="text/javascript" src="' + libraryName + '"&gt;&lt;/script&gt;');<br />  &#125;,<br />  findJavascriptPath: function() &#123;<br />    var scripts = document.getElementsByTagName("script");<br />    for (var x = 0; x &lt; scripts.length; x++) &#123;<br />      var s = scripts[x];<br />      if (s.src && s.src.match(/wicket-preview\.js(\?.*)?$/)) &#123;<br />        return s.src.replace(/wicket-preview\.js(\?.*)?$/,'');<br />      &#125;<br />    &#125;<br />  &#125;,<br />  load: function() &#123;<br />    var path = WicketPreview.findJavascriptPath();<br />    var includes = 'behaviour,dojo,wicket-preview-behaviour'.split(',');<br />    for (var x = 0; x &lt; includes.length; x++) &#123;<br />      var include = includes[x];<br />      WicketPreview.require(path + include + '.js');<br />    &#125;<br />  &#125;<br />&#125;<br /><br />WicketPreview.load();<br /></pre><br /><br /><p>The <code>wicket-preview-behaviour.js</code> file is the same as <a href="http://jroller.com/page/wireframe?entry=auto_previewable_wicket_pages">my previous blog</a>.  I just had to move the code into a new file to avoid conflicting with the bootstrapping code.</p><br /><pre><br />var myrules = &#123;<br />  'div': function(element) &#123;<br />    var url = element.getAttribute('wicket:preview');<br />    if (url) &#123;<br />      dojo.require("dojo.io.*");<br />      dojo.io.bind(&#123;<br />        url: url,<br />        load: function(type, data, evt) &#123; <br />        element.innerHTML = data;<br />      &#125;,<br />      mimetype: "text/plain"<br />      &#125;);<br />    &#125;<br />  &#125;<br />&#125;;<br /><br />Behaviour.register(myrules);<br /></pre><br /><br /><p>I'm becoming more convinced that this is a killer feature.  I have opened a <a href="https://sourceforge.net/tracker/index.php?func=detail&aid=1445715&group_id=119783&atid=684978">request for this feature to be integrated directly into Wicket</a>, but there's been no movement on it yet.  If anyone out there thinks this would be useful, please show your support on the Wicket mailing list or directly in the sourceforge issue I opened.</p><br /><br /><p>I think this pretty much sums out the outstanding work in order for this feature to be moved into the Wicket core.</p><br /><ol><br />  <li>Documentation.  Maybe add to the wicket examples or some other visible demo?</li><br />  <li>Add <code>wicket:preview</code> to the official Wicket DTD.  The <code>wicket:id</code> attribute is already there, and adding <code>wicket:preview</code> to the DTD will allow designers to create valid XHTML.  </li><br />  <li>Optionally remove the <code>wicket:preview</code> attributes at runtime.  Wicket has a setting to automatically remove the <code>wicket:id</code> attribute at runtime, and it should be able to support this as well.  It might already handle <code>wicket:*</code>, I don't really know about this one.</li><br /></ol><br /><br /><p>My next feat will be to improve this feature to try and handle multiple levels of component inheritance.  That should be quite a trick!</p><br /><br /><br /><!-- technorati tags begin --><br /><p style="font-size: 10px; text-align: right;">technorati tags: <br /><a href="http://technorati.com/tag/java" rel="tag">java</a>, <br /><a href="http://technorati.com/tag/wicket" rel="tag">wicket</a>,<br /><a href="http://technorati.com/tag/javascript" rel="tag">javascript</a>, <br /><a href="http://technorati.com/tag/ajax" rel="tag">ajax</a>, <br /><a href="http://technorati.com/tag/dojo" rel="tag">dojo</a>,<br /><a href="http://technorati.com/tag/behaviour" rel="tag">behaviour</a><br /></p><br /><!-- technorati tags end --></div>
